* Params

| 1 | 1 | 1 | 1 | 1 |
| 1 | 2 | 3 | 4 | 5 |
| 1 | 2 | 3 | 4 | 5 |
| 1 | 1 | 1 | 1 | 1 |
| 1 | 1 | 1 | 1 | 1 |
| 0 | 0 | 0 | 0 | 0 |

| 1 | 0 | 0 | 0 | 0 |
| 1 | 2 | 3 | 4 | 5 |
| 1 | 2 | 3 | 4 | 5 |
| 1 | 0 | 0 | 0 | 0 |
| 1 | 0 | 0 | 0 | 0 |

serialize:

| 1 | 2 | 3 | 4 | 5 | 7 | 8 | 12 | 13 | 17 | 18 | 22 | 23 |

deserialize:

| 1 | 1 | 1 |  1 |  1 |
| 2 | 6 | 8 | 10 | 12 |
| 3 | 7 | 9 | 11 | 13 |
| 4 | 4 | 4 |  4 |  4 |
| 5 | 5 | 5 |  5 |  5 |

% Find the leading elements of each row.
vix=zeros(size(v));
for i=1:size(v,1)
  [~,ia,ib]=unique([0,v(i,:)]);
  vix(i,ia(2:end)-1)=true;
end

% Index to serialize v (matrix -> vector)
seIx=find(vix(:));

% Inverse mapping to seIx
deIx=vix;
deIx(vix~=0)=1:length(seIx);

% Expand to all elements that should be equal.
for k=1:length(seIx)
  [i,j]=find(vix.*deIx==k);
  deIx(i,v(i,:)==v(i,j))=k;
end

------------------------------------------

| 1 | 1 | 1 | 1 | 1 | 1 |
| 1 | 1 | 2 | 2 | 3 | 3 |
| 1 | 1 | 2 | 2 | 3 | 3 |
| 1 | 1 | 1 | 1 | 1 | 1 |
| 1 | 1 | 1 | 1 | 1 | 1 |

| 1 | 0 | 0 | 0 | 0 | 0 |
| 1 | 0 | 2 | 0 | 3 | 0 |
| 1 | 0 | 2 | 0 | 3 | 0 |
| 1 | 0 | 0 | 0 | 0 | 0 |
| 1 | 0 | 0 | 0 | 0 | 0 |

serialize:

| 1 | 2 | 3 | 4 | 5 | 12 | 13 | 22 | 23 |

deserialize:

| 1 | 1 | 1 | 1 | 1 | 1 |
| 2 | 2 | 6 | 6 | 8 | 8 |
| 3 | 3 | 7 | 7 | 9 | 9 |
| 4 | 4 | 4 | 4 | 4 | 4 |
| 5 | 5 | 5 | 5 | 5 | 5 |

* Obs

IOblock

| 1 | 1 | 1 | 1 | 1 | 1 |
| 1 | 1 | 2 | 2 | 3 | 3 |
| 1 | 1 | 2 | 2 | 3 | 3 |
| 1 | 1 | 1 | 1 | 1 | 1 |
| 1 | 1 | 1 | 1 | 1 | 1 |
| 0 | 0 | 0 | 0 | 0 | 0 |

| 1 | 0 | 0 | 0 | 0 | 0 |
| 2 | 0 | 6 | 0 | 8 | 0 |
| 3 | 0 | 7 | 0 | 9 | 0 |
| 4 | 0 | 0 | 0 | 0 | 0 |
| 5 | 0 | 0 | 0 | 0 | 0 |
| 0 | 0 | 0 | 0 | 0 | 0 |

serialize

| 1 | 2 | 3 | 4 | 5 |  6 |  7 |  8 |  9 |
|---+---+---+---+---+----+----+----+----|
| 1 | 2 | 3 | 4 | 5 | 14 | 15 | 26 | 27 |

deserialize

| 1 | 1 | 1 | 1 | 1 | 1 |
| 2 | 2 | 6 | 6 | 8 | 8 |
| 3 | 3 | 7 | 7 | 9 | 9 |
| 4 | 4 | 4 | 4 | 4 | 4 |
| 5 | 5 | 5 | 5 | 5 | 5 |
| 0 | 0 | 0 | 0 | 0 | 0 |

| 1 | 2 | 3 | 4 | 5 | 7 | 8 | 9 | 10 | 11 | 13 | 14 | 15 | 16 | 17 | 19 | 20 | 21 | 22 | 23 | 25 | 26 | 27 | 28 | 29 | 31 | 32 | 33 | 34 | 35 |
|---+---+---+---+---+---+---+---+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----|
| 1 | 2 | 3 | 4 | 5 | 1 | 2 | 3 |  4 |  5 |  1 |  6 |  7 |  4 |  5 |  1 |  6 |  7 |  4 |  5 |  1 |  8 |  9 |  4 |  5 |  8 |  9 |  3 |  4 |  5 |


useIOobs

| 1 | 0 | 0 | 0 | 0 | 0 |
| 1 | 0 | 1 | 0 | 1 | 0 |
| 0 | 0 | 0 | 0 | 0 | 0 |
| 0 | 0 | 0 | 0 | 0 | 0 |
| 1 | 0 | 0 | 0 | 0 | 0 |
| 0 | 0 | 0 | 0 | 0 | 0 |

serialize

| 1 | 2 | 5 |  6 |  8 |
|---+---+---+----+----|
| 1 | 2 | 5 | 14 | 26 |



s.IOblock=[1,1,1,1,1,1;1,1,2,2,3,3;1,1,2,2,3,3;1,1,1,1,1,1;1,1,1,1,1,1;0,0,0,0,0,0];
s.estIO=[true(4,6);false(2,6)];
s.useIOobs=[false(1,6);true(2,6);false(3,6)];

IOblock

     1     1     1     1     1     1
     1     1     2     2     3     3
     1     1     2     2     3     3
     1     1     1     1     1     1
     1     1     1     1     1     1
     0     0     0     0     0     0

estIO

     1     1     1     1     1     1
     1     1     1     1     1     1
     1     1     1     1     1     1
     1     1     1     1     1     1
     0     0     0     0     0     0
     0     0     0     0     0     0

useIOObs

     0     0     0     0     0     0
     1     1     1     1     1     1
     1     1     1     1     1     1
     0     0     0     0     0     0
     0     0     0     0     0     0
     0     0     0     0     0     0

